# Requirements: Context Assembler AI

## Objective

Automatically assemble and inject only the relevant documentation into an agent’s context based on each new user message. The selection must be fast, deterministic, and focused on user intent, while keeping context minimal.

## Outcomes

### O1: Stateless selection per user input

For each new user message, select relevant docs from the global index and project docs using only that message as input. The assembler is stateless.

### O2: Delta‑only injection

Only inject newly selected docs that are not already present in the session context.

### O2.1: Persist injected docs

Store injected doc paths per session in the database as a newline‑delimited list in `context_paths` (one file path per line).

### O3: Primary runtime via fast API call

Use a direct OpenAI API call (fastest/cheapest model) to perform selection. Local LLM support can be added later behind the same interface.

### O4: Hook integration

Use existing CLI hook mechanisms to inject selected context when supported. For Codex, use the TMUX injection path.

### O5: Index resolution

Use a JSON index per doc set (`index.json`) generated by traversing markdown references and flattening file paths with tags. The assembler reads the index and selects docs based on user input.

### O5.1: Selector output shape

Selector output is a JSON array of file paths only. No extra metadata is required.

### O5.1: Project index path wiring

Each project exposes a single hook that provides the path to the project’s `index.json`, so the receiver can merge it with the global index at selection time.

### O5.2: Hook order and layering

Hooks run independently. Determine the actual hook order per CLI and ensure the final layering preserves “global first, project second.”

### O6: Hook injection formats

Hook output formats for Claude/Gemini are taken from `docs/3rd/` references.

## Acceptance Criteria

- [ ] A new user message triggers selection and delta‑only injection.
- [ ] Selection uses only the current user message as input.
- [ ] API‑based selector returns in under 2 seconds for typical inputs.
- [ ] Context size is bounded and only grows when new relevant docs are selected.
- [ ] Hook injection works for Claude/Gemini; Codex uses TMUX injection.
- [ ] Injected docs are persisted per session as a newline‑delimited list.
- [ ] Selector failure or timeout skips injection without blocking the session.
 - [ ] Hook handling behavior is implemented from `docs/3rd/` references, not guesses.
